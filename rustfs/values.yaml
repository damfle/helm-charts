# Default values for rustfs.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# RustFs-specific configuration that will be mounted as ConfigMap
config:
  enabled: false

# Configuration for the generic subchart
generic:
  # Override naming to use "rustfs" instead of "generic"
  nameOverride: "rustfs"

  # Override image settings for RustFs (using hacdias/rustfs)
  image:
    repository: rustfs/rustfs
    pullPolicy: IfNotPresent
    tag: "1.0.0-alpha.66" # Must be explicit for dependency charts

  # Service configuration
  service:
    type: ClusterIP
    port: 9090
    targetPort: http
    protocol: TCP
    portName: http

  # Container port configuration
  containerPort: 9090

  # ServiceAccount configuration
  serviceAccount:
    create: true
    automount: true
    annotations: {}
    name: ""

  # Single replica for RustFs
  replicaCount: 1

  # Pod configuration
  podAnnotations: {}
  podLabels: {}
  imagePullSecrets: []

  # Node scheduling
  nodeSelector: {}
  tolerations: []
  affinity: {}

  # RustFs specific environment variables
  env:
    - name: RUSTFS_ADDRESS
      value: ":9090"
    - name: RUSTFS_VOLUMES
      value: "/data"
    - name: RUSTFS_CONSOLE_ENABLE
      value: "true"

  # Configure persistence for RustFs data
  persistence:
    enabled: true
    accessModes:
      - ReadWriteOnce
    size: 16Gi
    mountPath: /data
    annotations: {}
    labels: {}

  # Resource limits and requests
  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi

  # Health checks
  livenessProbe:
    httpGet:
      path: /
      port: http
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /
      port: http
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

  # Security context
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false

  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000

  # ServiceMonitor for Prometheus monitoring (disabled by default for RustFs)
  serviceMonitor:
    enabled: false
    portName: http
    path: /metrics
    interval: 30s
    scrapeTimeout: 10s
    labels: {}
    annotations: {}

  # Ingress configuration (recommended for RustFs external access)
  ingress:
    enabled: false
    className: ""
    annotations: {}
      # Common annotations for RustFs
      # nginx.ingress.kubernetes.io/proxy-body-size: "0"
      # nginx.ingress.kubernetes.io/proxy-request-buffering: "off"
      # For Traefik (as per your setup):
      # traefik.ingress.kubernetes.io/router.entrypoints: web,websecure
      # traefik.ingress.kubernetes.io/router.middlewares: authentik-ak-outpost-authentik-embedded-outpost@kubernetescrd
    hosts:
      - host: rustfs.local
        paths:
          - path: /
            pathType: Prefix
    tls: []
      # - secretName: rustfs-tls
      #   hosts:
      #     - rustfs.local
